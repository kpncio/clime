<!DOCTYPE html>
<html lang='en'>
    <head>
        <title>KPNC Forecaster</title>
        <meta charset='UTF-8'>
        <meta name='theme-color' content='#1472FC'>
        <meta name='author' content='KPNC Technology'>
        <meta name='description' content='KPNC Technology: Forecaster: Current environmental conditions...'>
        <meta name='viewport' content='width=device-width, height=device-height, initial-scale=1.0'>
        <meta http-equiv='X-UA-Compatible' content='ie=edge'>
        <link href='https://content.kpnc.io/' rel='preconnect'>
        <link href='https://content.kpnc.io/css/forecaster.css' rel='stylesheet'>
        <link href='https://content.kpnc.io/css/roboto-mono.css' rel='stylesheet'>
        <link href='https://content.kpnc.io/img/kpnc/forecaster.png' rel='icon'>
        <link href='https://content.kpnc.io/lib/leaflet/leaflet.css' rel='stylesheet'>
        <script src='https://content.kpnc.io/lib/leaflet/leaflet.js'></script>
    </head>
    <body>
        <main>
            <header>
                <a href='https://www.kpnc.io'>
                    <img src='https://content.kpnc.io/img/kpnc/logodark.webp' alt='~KPNC~'>
                </a>

                <small>2022 &copy; KPNC Technology // Forecaster: <a href='https://github.com/kpncio/forecaster' target='_blank'>GitHub</a></small><br>
                <small>External geolocation from: <a href='https://www.maxmind.com/en/home' target='_blank'>Maxmind</a></small><br>
                <small>Weather data from: <a href='https://www.weatherapi.com/' target='_blank'>WeatherAPI</a></small>
            </header>

            <header>
                <div class='weather'>
                    <h1><img src='https:${icon}' alt='ðŸŒŸ'> ${temp}</h1>
                </div>
                
                <h2 id='date'>-------, ------- ----</h2>
                <h2 id='time'>--:--:-- --</h2>

                <small id="hint">*Browser Location Data*</small>
            </header>

            <div class='container'>
                <p><strong>Generated Data:</strong></p><br>
                <table>
                    <tbody>
                        <tr>
                            <td><p>&rtrif; Latitude</p></td>
                            <td><input type='text' class='data' value='${latitude}'/></td>
                        </tr>
                        <tr>
                            <td><p>&rtrif; Longitude</p></td>
                            <td><input type='text' class='data' value='${longitude}'/></td>
                        </tr>
                        <tr>
                            <td><p>&rtrif; City</p></td>
                            <td><input type='text' class='data' value='${city}'/></td>
                        </tr>
                        <tr>
                            <td><p>&rtrif; Region</p></td>
                            <td><input type='text' class='data' value='${region}'/></td>
                        </tr>
                        <tr>
                            <td><p>&rtrif; Country</p></td>
                            <td><input type='text' class='data' value='${country}'/></td>
                        </tr>
                        <tr>
                            <td><p>&rtrif; Timezone</p></td>
                            <td><input type='text' class='data' value='${timezone}'/></td>
                        </tr>
                        <tr>
                            <td><p>&rtrif; Data Point</p></td>
                            <td><input type='text' class='data' value='${location}'/></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <br>
            <div class='container'>
                <p><strong>Weather Data:</strong></p><br>
                <table>
                    <tbody>
                        <tr>
                            <td><p>&rtrif; Condition</p></td>
                            <td><input type='text' class='data' value='${condition}'/></td>
                        </tr>
                        <tr>
                            <td><p>&rtrif; Temperature</p></td>
                            <td><input type='text' class='data' value='${temperature}'/></td>
                        </tr>
                        <tr>
                            <td><p>&rtrif; Feels Like</p></td>
                            <td><input type='text' class='data' value='${feelslike}'/></td>
                        </tr>
                        <tr>
                            <td><p>&rtrif; Humidity</p></td>
                            <td><input type='text' class='data' value='${humidity}'/></td>
                        </tr>
                        <tr>
                            <td><p>&rtrif; Wind Speed</p></td>
                            <td><input type='text' class='data' value='${windspeed}'/></td>
                        </tr>
                        <tr>
                            <td><p>&rtrif; Wind Direction</p></td>
                            <td><input type='text' class='data' value='${winddirection}'/></td>
                        </tr>
                        <tr>
                            <td><p>&rtrif; Pressure</p></td>
                            <td><input type='text' class='data' value='${pressure}'/></td>
                        </tr>
                        <tr>
                            <td><p>&rtrif; UVI</p></td>
                            <td><input type='text' class='data' value='${uvi}'/></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <br>
            <div class='container'>
                <p><strong>Air Quality Data:</strong></p><br>
                <table>
                    <tbody>
                        <tr>
                            <td><p>&rtrif; AQI</p></td>
                            <td><input type='text' class='data' value='${aqi}'/></td>
                        </tr>
                        <tr>
                            <td><p>&rtrif; PM 2.5</p></td>
                            <td><input type='text' class='data' value='${pm25}'/></td>
                        </tr>
                        <tr>
                            <td><p>&rtrif; PM 10</p></td>
                            <td><input type='text' class='data' value='${pm10}'/></td>
                        </tr>
                        <tr>
                            <td><p>&rtrif; Ozone</p></td>
                            <td><input type='text' class='data' value='${o3}'/></td>
                        </tr>
                        <tr>
                            <td><p>&rtrif; Carbon Monoxide</p></td>
                            <td><input type='text' class='data' value='${co}'/></td>
                        </tr>
                        <tr>
                            <td><p>&rtrif; Nitrogen Dioxide</p></td>
                            <td><input type='text' class='data' value='${no2}'/></td>
                        </tr>
                        <tr>
                            <td><p>&rtrif; Sulfur Dioxide</p></td>
                            <td><input type='text' class='data' value='${so2}'/></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <br>
            <div class='container'>
                <p><strong>Map Visualization:</strong></p><br>
                <div id='map' style='height: 250px; font-size: 11px; text-align: center;'>*Map loading...</div>
            </div>
        </main>

        <script>
            var map = L.map('map').setView([${latitude}, ${longitude}], 11);
                    
            var tiles = L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
                maxZoom: 18,
                attribution: "Map Data & Imagery &copy; <a href='https://www.openstreetmap.org/copyright' target='_blank'>OpenStreetMap</a> & <a href='https://www.mapbox.com/' target='_blank'>Mapbox</a>",
                id: 'mapbox/dark-v10',
                tileSize: 512,
                zoomOffset: -1,
                accessToken: 'pk.eyJ1IjoiYWxiaWU2NTQ0IiwiYSI6ImNsMjV1YmdmMTJkcTMza3BkZTdmbnY1bTcifQ.YpT_p-H1WckYccV8_HoLHg'
            }).addTo(map);
        </script>

        <video playsinline autoplay muted loop src='https://content.kpnc.io/vid/suburb10.mp4' preload='metadata'></video>
    </body>

    <script>
        let days = new Array('Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday');
        let months = new Array('January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December');

        function ordinal(i) {
            var j = i % 10,
                k = i % 100;
            if (j == 1 && k != 11) {
                return i + "st";
            }
            if (j == 2 && k != 12) {
                return i + "nd";
            }
            if (j == 3 && k != 13) {
                return i + "rd";
            }
            return i + "th";
        }

        function set(now) {
            document.getElementById('date').innerHTML = days[now.getDay()] + ', ' + months[now.getMonth()] + ' ' + ordinal(now.getDate());
            document.getElementById('time').innerHTML = now.toLocaleTimeString()
        }

        setInterval(() => set(new Date()), 1000);

        let date = new Date();
        let time = ((((date.getHours() * 60) + date.getMinutes()) * 60) + date.getSeconds()) * 0.1;

        document.querySelector('video').addEventListener('loadeddata', function() {
            this.playbackRate = 0.1;
            this.currentTime = time;
        }, false);

        set(new Date());

        setTimeout(() => window.location.href = window.location.href, 3600000);
    </script>

    <script>
        if('geolocation' in navigator) {
            if (!new URLSearchParams(window.location.search).has('nav')) {
                navigator.geolocation.getCurrentPosition((position) => {
                    var url = window.location.href;
                    if (url.indexOf('?') > -1){
                        url += '&nav=' + position.coords.latitude + ',' + position.coords.longitude;
                    } else {
                        url += '?nav=' + position.coords.latitude + ',' + position.coords.longitude;
                    }
                    window.location.href = url;
                }, document.getElementById('hint').remove());
            }
        } else {
            document.getElementById('hint').remove();
        }
    </script>

    ${error}
</html>